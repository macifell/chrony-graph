#!/bin/bash

INTERVAL=121
exclude="--exclude index.html.tmpl --exclude index.html.IN --exclude measurements.* --exclude statistics.* --exclude tracking.*"

# Do not use linlog axes for Remote Clocks Summary for readability
export FORCE_LINEAR_ALLSTAR=1

./bin/substitute home/*.IN
rsync -au $exclude home/. ./www

while true; do
  (cd weekly && FREQ=Weekly ../bin/run --plus-svg 7)
  rsync -au $exclude weekly ./www

  for i in 1 2 3 4 5 6; do
    (cd daily && FREQ=Daily ../bin/run --plus-svg 1)
    rsync -au $exclude daily ./www

    ./bin/substitute home/*.IN
    rsync -au $exclude home/. ./www

    sleep $INTERVAL
  done
done
