#!/bin/bash

exclude="--exclude index.html.tmpl --exclude index.html.IN --exclude measurements.* --exclude statistics.* --exclude tracking.*"

# Do not use linlog axes for Remote Clocks Summary for readability
export FORCE_LINEAR_ALLSTAR=1

function generate_home () {
  ./bin/substitute home/*.IN
  rsync -au $exclude home/. ./www
}

function generate_daily () {
  (cd daily && FREQ=Daily ../bin/run --plus-svg 1)
  rsync -au $exclude daily ./www
}

function generate_weekly () {
  (cd weekly && FREQ=Weekly ../bin/run --plus-svg 7)
  rsync -au $exclude weekly ./www
}

generate_home
generate_daily

while true; do
  generate_weekly
  sleep $INTERVAL

  for i in {1..7}; do
    generate_home
    generate_daily
    sleep $INTERVAL
  done
done
