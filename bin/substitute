#!/bin/bash

stratum=$(chronyc tracking | grep 'Stratum' | cut -d ':' -f2 | xargs);
reference=$(chronyc tracking | grep 'Reference ID' | cut -d '(' -f2 | cut -d ')' -f1);

# Replace template strings such as THISHOST, for host independence
for i in "$@"
do
  sed -e "s/__THISHOST__/${THISHOST:-localhost}/" \
      -e "s/__ACCESS__/${ACCESS:-Public}/" \
      -e "s/__STRATUM__/${stratum:-99}/" \
      -e "s/__REFERENCE__/${reference:-none}/" \
      -e "s/__CONTACT__/${CONTACT:-none}/" \
    < "$i" > "${i/.IN/}"
done
